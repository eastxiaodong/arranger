{
  "id": "universal_flow_v1",
  "name": "Universal Multi-Scenario Flow",
  "version": "1.0.0",
  "description": "Unified workflow covering feature, bug, doc, discussion, test, optimization and ops-hotfix scenarios with scenario-aware phases.",
  "metadata": {
    "integration_targets": ["workflow_event", "proof_attested", "sentinel_event"],
    "scenarios": [
      "new_feature",
      "bug_fix",
      "doc_work",
      "ops_hotfix",
      "optimization",
      "refactor",
      "test_request",
      "discussion"
    ]
  },
  "phases": [
    {
      "id": "intake_alignment",
      "title": "接入与对齐",
      "description": "统一梳理用户诉求、已有上下文与目标，生成可追溯的需求概述。",
      "entry": {
        "auto_tasks": [
          {
            "template": "intake_summary",
            "intent": "collect_intake_context",
            "assignee_role": "coordinator",
            "labels": ["workflow:auto"],
            "metadata": {
              "description": "收集背景、目标、验收标准以及潜在风险。"
            }
          }
        ]
      },
      "exit": {
        "require_decisions": ["intake_confirmed"],
        "require_artifacts": ["requirement_brief"]
      }
    },
    {
      "id": "optimization_baseline",
      "title": "指标基线采集",
      "description": "针对性能/稳定性场景采集现状指标，形成基线报告。",
      "dependencies": ["intake_alignment"],
      "scenario_tags": ["optimization"],
      "entry": {
        "auto_tasks": [
          {
            "template": "collect_slo_data",
            "intent": "collect_baseline_metrics",
            "assignee_role": "analyzer",
            "labels": ["workflow:auto"],
            "metadata": {
              "description": "同步监控、日志、SLO/SLA 等原始数据。"
            }
          }
        ]
      },
      "exit": {
        "require_artifacts": ["baseline_report"],
        "require_decisions": ["baseline_confirmed"]
      }
    },
    {
      "id": "clarify",
      "title": "需求澄清",
      "dependencies": ["intake_alignment"],
      "scenario_tags": ["new_feature", "refactor", "optimization"],
      "entry": {
        "auto_tasks": [
          {
            "template": "clarify_requirement",
            "intent": "clarify_requirement",
            "assignee_role": "coordinator",
            "labels": ["workflow:auto"]
          }
        ]
      },
      "exit": {
        "require_decisions": ["clarified_scope"],
        "require_artifacts": ["acceptance_criteria"]
      }
    },
    {
      "id": "refactor_risk",
      "title": "重构风险评估",
      "description": "评估影响面、回滚策略与合规风险。",
      "dependencies": ["clarify"],
      "scenario_tags": ["refactor"],
      "entry": {
        "auto_tasks": [
          {
            "template": "refactor_risk_plan",
            "intent": "evaluate_refactor_risk",
            "assignee_role": "analyzer",
            "labels": ["workflow:auto"],
            "metadata": {
              "description": "输出回滚策略、依赖影响与缓解措施。"
            }
          }
        ]
      },
      "exit": {
        "require_decisions": ["refactor_risks_signed"],
        "require_artifacts": ["refactor_plan"]
      }
    },
    {
      "id": "plan",
      "title": "方案与拆解",
      "dependencies": ["clarify", "optimization_baseline", "refactor_risk"],
      "scenario_tags": ["new_feature", "refactor", "optimization"],
      "entry": {
        "auto_tasks": [
          {
            "template": "architecture_plan",
            "intent": "create_architecture_plan",
            "assignee_role": "developer",
            "labels": ["workflow:auto"]
          }
        ]
      },
      "exit": {
        "require_decisions": ["architecture_signoff"],
        "require_tasks_created": ["design_tasks_generated", "implementation_tasks_generated"]
      }
    },
    {
      "id": "build",
      "title": "实现与迭代",
      "dependencies": ["plan"],
      "scenario_tags": ["new_feature", "refactor", "optimization"],
      "entry": {
        "auto_tasks": [
          {
            "generator": "feature_breakdown",
            "intent": "implement_requirement",
            "assignee_role": "developer",
            "priority": "high",
            "labels": ["workflow:auto", "workflow:business_task"],
            "metadata": {
              "description": "开发或改造业务功能，提交代码/配置。"
            }
          }
        ]
      },
      "exit": {
        "require_tasks_completed": ["implementation_complete"],
        "require_defects_open": 0
      }
    },
    {
      "id": "verify",
      "title": "验证与论证",
      "dependencies": ["build"],
      "scenario_tags": ["new_feature", "refactor", "optimization"],
      "exit": {
        "require_decisions": ["qa_signoff"],
        "require_defects_open": 0
      }
    },
    {
      "id": "delivery",
      "title": "交付与总结",
      "dependencies": ["verify"],
      "scenario_tags": ["new_feature", "refactor", "optimization"],
      "entry": {
        "auto_tasks": [
          {
            "template": "compile_release_note",
            "intent": "compile_release_note",
            "assignee_role": "documenter",
            "labels": ["workflow:auto"]
          }
        ]
      },
      "exit": {
        "require_artifacts": ["release_package"],
        "require_decisions": ["release_approved"]
      }
    },
    {
      "id": "doc_outline",
      "title": "文档大纲",
      "dependencies": ["intake_alignment"],
      "scenario_tags": ["doc_work", "discussion"],
      "entry": {
        "auto_tasks": [
          {
            "template": "doc_collect_context",
            "intent": "collect_doc_context",
            "assignee_role": "coordinator",
            "labels": ["workflow:auto"]
          }
        ]
      },
      "exit": {
        "require_artifacts": ["outline"],
        "require_decisions": ["doc_scope_locked"]
      }
    },
    {
      "id": "doc_draft",
      "title": "撰写草稿",
      "dependencies": ["doc_outline"],
      "scenario_tags": ["doc_work", "discussion"],
      "entry": {
        "auto_tasks": [
          {
            "generator": "doc_delivery",
            "intent": "write_doc_draft",
            "assignee_role": "documenter",
            "labels": ["workflow:auto", "workflow:business_task"],
            "generator_options": {
              "stage": "draft"
            }
          }
        ]
      },
      "exit": {
        "require_tasks_completed": ["doc_draft_complete"]
      }
    },
    {
      "id": "doc_review",
      "title": "多角色评审",
      "dependencies": ["doc_draft"],
      "scenario_tags": ["doc_work", "discussion"],
      "exit": {
        "require_decisions": ["tech_review_passed", "product_review_passed"],
        "require_defects_open": 0
      }
    },
    {
      "id": "doc_publish",
      "title": "发布与归档",
      "dependencies": ["doc_review"],
      "scenario_tags": ["doc_work", "discussion"],
      "entry": {
        "auto_tasks": [
          {
            "generator": "doc_delivery",
            "intent": "publish_doc",
            "assignee_role": "admin",
            "labels": ["workflow:auto", "workflow:business_task"],
            "generator_options": {
              "stage": "publish"
            }
          }
        ]
      },
      "exit": {
        "require_artifacts": ["doc_url"],
        "require_decisions": ["publish_approved"]
      }
    },
    {
      "id": "discussion_loop",
      "title": "讨论与结论",
      "dependencies": ["intake_alignment"],
      "scenario_tags": ["discussion"],
      "entry": {
        "auto_tasks": [
          {
            "template": "discussion_summarize",
            "intent": "facilitate_discussion",
            "assignee_role": "coordinator",
            "labels": ["workflow:auto"],
            "metadata": {
              "description": "整理观点、跟进提案，必要时转入正式流程。"
            }
          }
        ]
      },
      "exit": {
        "require_decisions": ["discussion_conclusion"],
        "require_artifacts": ["discussion_summary"]
      }
    },
    {
      "id": "discussion_archive",
      "title": "讨论归档",
      "dependencies": ["discussion_loop"],
      "scenario_tags": ["discussion"],
      "exit": {
        "require_decisions": ["discussion_archived"]
      }
    },
    {
      "id": "bug_reproduce",
      "title": "缺陷复现",
      "dependencies": ["intake_alignment"],
      "scenario_tags": ["bug_fix"],
      "entry": {
        "auto_tasks": [
          {
            "template": "bug_collect_context",
            "intent": "collect_bug_repro",
            "assignee_role": "tester",
            "labels": ["workflow:auto"],
            "metadata": {
              "description": "收集复现步骤、日志、截图，标记影响范围。"
            }
          }
        ]
      },
      "exit": {
        "require_artifacts": ["bug_repro_report"],
        "require_decisions": ["incident_confirmed"]
      }
    },
    {
      "id": "bug_root_cause",
      "title": "根因分析",
      "dependencies": ["bug_reproduce"],
      "scenario_tags": ["bug_fix"],
      "entry": {
        "auto_tasks": [
          {
            "template": "bug_root_cause",
            "intent": "analyze_root_cause",
            "assignee_role": "developer",
            "labels": ["workflow:auto"]
          }
        ]
      },
      "exit": {
        "require_decisions": ["root_cause_agreed"],
        "require_artifacts": ["rca_note"]
      }
    },
    {
      "id": "bug_fix",
      "title": "缺陷修复",
      "dependencies": ["bug_root_cause"],
      "scenario_tags": ["bug_fix"],
      "entry": {
        "auto_tasks": [
          {
            "generator": "bugfix_lane",
            "intent": "fix_bug",
            "assignee_role": "developer",
            "priority": "high",
            "labels": ["workflow:auto", "workflow:business_task"],
            "metadata": {
              "description": "修复缺陷并提交补丁，必要时申请审批。"
            }
          }
        ]
      },
      "exit": {
        "require_tasks_completed": ["bugfix_complete"],
        "require_defects_open": 0
      }
    },
    {
      "id": "bug_regression",
      "title": "回归验证",
      "dependencies": ["bug_fix"],
      "scenario_tags": ["bug_fix"],
      "exit": {
        "require_decisions": ["regression_passed"],
        "require_defects_open": 0
      }
    },
    {
      "id": "ops_detect",
      "title": "告警与确认",
      "dependencies": ["intake_alignment"],
      "scenario_tags": ["ops_hotfix"],
      "entry": {
        "auto_tasks": [
          {
            "template": "ops_collect_alarm",
            "intent": "collect_alarm_details",
            "assignee_role": "sentinel",
            "labels": ["workflow:auto"]
          }
        ]
      },
      "exit": {
        "require_decisions": ["incident_confirmed"]
      }
    },
    {
      "id": "ops_mitigate",
      "title": "诊断与止血",
      "dependencies": ["ops_detect"],
      "scenario_tags": ["ops_hotfix"],
      "exit": {
        "require_tasks_completed": ["mitigation_done"],
        "require_defects_open": 0
      }
    },
    {
      "id": "ops_fix",
      "title": "修复与验证",
      "dependencies": ["ops_mitigate"],
      "scenario_tags": ["ops_hotfix"],
      "entry": {
        "auto_tasks": [
          {
            "generator": "ops_hotfix",
            "intent": "mitigate_incident",
            "assignee_role": "developer",
            "labels": ["workflow:auto", "workflow:business_task"]
          }
        ]
      },
      "exit": {
        "require_decisions": ["qa_verdict"],
        "require_defects_open": 0
      }
    },
    {
      "id": "ops_postmortem",
      "title": "复盘与发布",
      "dependencies": ["ops_fix"],
      "scenario_tags": ["ops_hotfix"],
      "exit": {
        "require_artifacts": ["postmortem_report"],
        "require_decisions": ["release_signed_off"]
      }
    },
    {
      "id": "test_plan",
      "title": "测试计划",
      "dependencies": ["intake_alignment"],
      "scenario_tags": ["test_request"],
      "entry": {
        "auto_tasks": [
          {
            "template": "test_define_scope",
            "intent": "define_test_scope",
            "assignee_role": "tester",
            "labels": ["workflow:auto"]
          }
        ]
      },
      "exit": {
        "require_decisions": ["test_scope_approved"]
      }
    },
    {
      "id": "test_execute",
      "title": "执行与记录",
      "dependencies": ["test_plan"],
      "scenario_tags": ["test_request"],
      "entry": {
        "auto_tasks": [
          {
            "generator": "test_request",
            "intent": "run_tests",
            "assignee_role": "tester",
            "labels": ["workflow:auto", "workflow:business_task"],
            "metadata": {
              "description": "运行脚本/流水线并收集日志、缺陷。"
            }
          }
        ]
      },
      "exit": {
        "require_tasks_completed": ["test_execution_done"],
        "require_defects_open": 0
      }
    },
    {
      "id": "test_report",
      "title": "结果分析",
      "dependencies": ["test_execute"],
      "scenario_tags": ["test_request"],
      "entry": {
        "auto_tasks": [
          {
            "template": "test_publish_report",
            "intent": "publish_test_report",
            "assignee_role": "tester",
            "labels": ["workflow:auto"]
          }
        ]
      },
      "exit": {
        "require_artifacts": ["test_report"],
        "require_decisions": ["test_signoff"]
      }
    }
  ]
}
