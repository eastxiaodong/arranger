# Fix Plan 验收清单（草稿 v1）
> 供 PM/FE/BE/QA 联合验证。每条包含触发步骤与预期结果。后续按验证结果补充证据/截图，并在 `docs/fix-plan.md` 更新状态。

## 1. 指派规则
- 触发：配置启用/停用/离线 Agent，创建任务或用户消息触发指派。
- 预期：仅启用+在线+LLM配置完整的 Agent 被指派；停用/离线被跳过并有日志/提示。

## 2. 任务依赖编排
- 触发：在同一会话创建串行任务，含跨批依赖。
- 预期：后续任务 `dependencies` 补齐前序；前序完成后后续自动解阻到队列；阻塞/失败会向下游传递阻塞原因。

## 3. ACE 写入（输出）
- 触发：任务完成流程。
- 预期：调用 ACE refresh；ToolRun 记录；黑板/通知提示“已同步”或失败原因；状态事件可见。

## 4. ACE 检索（输入）
- 触发：任务进入 assigned/运行前。
- 预期：自动检索，结果/错误写 metadata + 黑板 + 通知，避免重复检索。

## 5. 跨批次依赖归并
- 触发：同 session/plan/goal 多批任务创建。
- 预期：新任务自动依赖未完成上游；阻塞/解阻逻辑正确。

## 6. 并发/容量控制
- 触发：同会话多任务 & 同 Agent 多任务排队。
- 预期：会话/Agent 并发上限生效；不可用 Agent 任务回队并告警。

## 7. 全局 Agent 状态持久化
- 触发：查看状态源 & 指派/调度。
- 预期：Agent 状态/健康/负载来源于全局配置+StateStore；调度/降级读取最新。

## 8. ACE 状态显示
- 触发：执行 ACE index/search/test。
- 预期：ToolRun + 黑板/通知显示进度/成功/失败，中文文案。

## 9. 中文化
- 触发：检查 Webview UI、黑板/通知/提示文本。
- 预期：无英文残留（保留必要技术名词）；标签/提示中文一致。

## 10. MCP 调用与回显
- 触发：触发 MCP 工具。
- 预期：ToolRun 记录，黑板消息含 server/tool，错误中文提示。

## 11. 命令/终端/Web 工具
- 触发：run_tool_command/Web 获取等。
- 预期：ToolRun + 黑板输出 stdout/stderr/JSON，敏感提示中文。

## 12. ACE 串联（索引/检索提示）
- 触发：索引/搜索流程。
- 预期：索引/搜索节点均有 ToolRun/提示/错误反馈；检索有上下文提示。

## 13. 跨批依赖归并（功能/会话）
- 同 5，验证功能/会话维度的依赖串联。

## 14. 并发/容量控制（调度侧）
- 触发：Agent busy/offline 时调度。
- 预期：并发1，离线或超限回队，告警可见。

## 15. 全局 Agent 数据贯通
- 触发：查看 UI/指派/调度。
- 预期：状态/metrics 统一来源，全局/项目一致展示。

## 16. 工具/MCP 回显完善
- 触发：多类工具运行。
- 预期：黑板/ToolRun 中文状态/错误，发起人归属正确。

## 17. 状态编排层（SSOT）
- 触发：任务/协助/工具/敏感/健康操作。
- 预期：全走 StateStore，状态事件广播；无直写 DB 旁路。

## 18. 调度经理池/降级
- 触发：经理离线/异常/轮值阈值。
- 预期：自动轮换仅选可用经理；黑板/通知广播；任务回队重指派。

## 19. 协助链路/反馈
- 触发：创建/指派/完成协助；提交反馈（含优先级）。
- 预期：StateStore 记录，黑板播报；优先级反馈调整任务优先级。

## 20. 任务状态机对齐
- 触发：各状态转移（pending/active/blocked/needs-confirm/reassigning/finalizing/done/failed）。
- 预期：非法转移被拒；转移有事件/历史记录；DB 与 StateStore 一致。

## 21. 敏感命令/风险控制
- 触发：执行含敏感词命令。
- 预期：命中策略写 StateStore，任务置 needs-confirm/blocked，黑板+通知中文提示。

## 22. Agent 健康/降级播报
- 触发：Agent 心跳中断、错误累积。
- 预期：健康状态更新；降级/回队/经理切换广播。

## 23. 代码债务清理
- 触发：代码扫描/手查。
- 预期：无 .DS_Store/无用文件；文案统一；遗留 DOM/CSS/JS 逐步清理计划。
